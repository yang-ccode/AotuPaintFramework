<Window x:Class="AotuPaintFramework.Views.MaterialPaintView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Material Paint Tool"
        Height="600"
        Width="800"
        WindowStartupLocation="CenterScreen"
        Background="White">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <!-- White background with Blue accent -->
                <materialDesign:BundledTheme BaseTheme="Light" 
                                            PrimaryColor="DeepPurple" 
                                            SecondaryColor="Lime" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesign3.Defaults.xaml" />
            </ResourceDictionary.MergedDictionaries>
            
            <!-- Add BooleanToVisibilityConverter -->
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Select Element Button -->
        <Button Grid.Row="0" 
                Content="Select Element"
                Command="{Binding SelectElementCommand}"
                Style="{StaticResource MaterialDesignRaisedButton}"
                Height="40"
                Margin="0,0,0,12"/>

        <!-- Categories Section Header -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Check all"
                    Command="{Binding CheckAllCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="32"
                    Margin="0,0,8,0"/>
            <Button Content="Uncheck all"
                    Command="{Binding UncheckAllCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="32"/>
        </StackPanel>

        <!-- Categories DataGrid -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding CategoryMappings}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="False"
                  CanUserSortColumns="False"
                  SelectionMode="Single"
                  HeadersVisibility="Column"
                  RowHeight="40"
                  Margin="0,0,0,12">
            <DataGrid.Columns>
                <!-- Checkbox Column -->
                <DataGridCheckBoxColumn Header="" 
                                        Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                        Width="50"/>
                
                <!-- Category Column -->
                <DataGridTextColumn Header="Category" 
                                    Binding="{Binding Category}"
                                    Width="150"
                                    IsReadOnly="True"/>
                
                <!-- Parameter Column -->
                <DataGridTemplateColumn Header="Parameter" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding DataContext.AvailableParameters, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedItem="{Binding Parameter, UpdateSourceTrigger=PropertyChanged}"
                                      Margin="4,2"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- Parameter Value Column -->
                <DataGridTemplateColumn Header="Parameter Value" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding AvailableParameterValues}"
                                      SelectedItem="{Binding ParameterValue, UpdateSourceTrigger=PropertyChanged}"
                                      Margin="4,2"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- Material Column -->
                <DataGridTemplateColumn Header="Material" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding DataContext.AvailableMaterials, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedItem="{Binding Material, UpdateSourceTrigger=PropertyChanged}"
                                      Margin="4,2"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Paint Options -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,12">
            <CheckBox Content="Side Face" 
                      IsChecked="{Binding IsSideFaceChecked}"
                      Margin="0,0,24,0"/>
            <CheckBox Content="Bottom Face" 
                      IsChecked="{Binding IsBottomFaceChecked}"
                      Margin="0,0,24,0"/>
            <CheckBox Content="Interfaces" 
                      IsChecked="{Binding IsInterfacesChecked}"/>
        </StackPanel>

        <!-- Interfaces Section -->
        <GroupBox Grid.Row="4" 
                  Header="Interfaces"
                  Visibility="{Binding IsInterfacesSectionVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  Style="{StaticResource MaterialDesignGroupBox}"
                  Margin="0,0,0,12"
                  Padding="12">
            <StackPanel>
                <!-- Buttons and Count -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Button Content="Pick Faces"
                            Command="{Binding PickFacesCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Height="32"
                            Margin="0,0,8,0"/>
                    <Button Content="Clear All"
                            Command="{Binding ClearAllFacesCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Height="32"
                            Margin="0,0,16,0"/>
                    <TextBlock Text="{Binding SelectedFacesCount, StringFormat='ÄÃ£ chá»n: {0} faces'}"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Faces ListBox -->
                <ListBox ItemsSource="{Binding PickedFaces}"
                         MaxHeight="200"
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                <CheckBox IsChecked="{Binding IsChecked}"
                                          Margin="0,0,8,0"/>
                                <TextBlock VerticalAlignment="Center">
                                    <Run Text="{Binding FaceName, Mode=OneWay}"/>
                                    <Run Text=" - "/>
                                    <Run Text="{Binding CategoryName, Mode=OneWay}"/>
                                    <Run Text=" [ID: "/>
                                    <Run Text="{Binding ElementId, Mode=OneWay}"/>
                                    <Run Text="]"/>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </GroupBox>

        <!-- Note -->
        <Border Grid.Row="5"
                Background="#FFFEF3C7"
                BorderBrush="#FF8B6914"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12,8"
                Margin="0,0,0,12">
            <TextBlock Foreground="#FF8B6914"
                       FontStyle="Italic">
                <Run Text="ðŸ’¡"/>
                <Run Text="LÆ°u Ã½: Pháº£i transfer váº­t liá»‡u coffa trÆ°á»›c khi Paint"/>
            </TextBlock>
        </Border>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Remove Paint"
                    Command="{Binding RemovePaintCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="36"
                    Margin="0,0,8,0"/>
            <Button Content="Paint"
                    Command="{Binding PaintCommand}"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Height="36"
                    Margin="0,0,8,0"/>
            <Button Content="Close"
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Height="36"/>
        </StackPanel>
    </Grid>
</Window>
