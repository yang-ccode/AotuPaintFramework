<Window x:Class="AotuPaintFramework.Views.MaterialPaintView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Material Paint Tool"
        Height="700" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        FontFamily="{DynamicResource MaterialDesignFont}">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- DataGrid Style -->
        <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>
        
        <Style TargetType="DataGridCell" BasedOn="{StaticResource MaterialDesignDataGridCell}">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Select Element Button -->
        <Button Grid.Row="0" 
                Content="Select Element"
                Command="{Binding SelectElementCommand}"
                Style="{StaticResource MaterialDesignRaisedButton}"
                Height="40"
                Margin="0,0,0,12"
                materialDesign:ButtonAssist.CornerRadius="4"/>

        <!-- Categories Section Header -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Check all"
                    Command="{Binding CheckAllCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="32"
                    Margin="0,0,8,0"
                    materialDesign:ButtonAssist.CornerRadius="4"/>
            <Button Content="Uncheck all"
                    Command="{Binding UncheckAllCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="32"
                    materialDesign:ButtonAssist.CornerRadius="4"/>
        </StackPanel>

        <!-- Categories DataGrid -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding CategoryMappings}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="False"
                  CanUserSortColumns="False"
                  SelectionMode="Single"
                  HeadersVisibility="Column"
                  RowHeight="40"
                  Margin="0,0,0,12"
                  materialDesign:DataGridAssist.CellPadding="8,4"
                  materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
            <DataGrid.Columns>
                <!-- Checkbox Column -->
                <DataGridCheckBoxColumn Header="" 
                                        Binding="{Binding IsChecked, UpdateSourceTrigger=PropertyChanged}"
                                        Width="50"
                                        ElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnStyle}"
                                        EditingElementStyle="{StaticResource MaterialDesignDataGridCheckBoxColumnEditingStyle}"/>
                
                <!-- Category Column -->
                <DataGridTextColumn Header="Category" 
                                    Binding="{Binding Category}"
                                    Width="150"
                                    IsReadOnly="True"/>
                
                <!-- Parameter Column -->
                <DataGridTemplateColumn Header="Parameter" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding DataContext.AvailableParameters, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedItem="{Binding Parameter, UpdateSourceTrigger=PropertyChanged}"
                                      materialDesign:HintAssist.Hint="Select Parameter"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      Margin="4,2">
                                <ComboBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </ComboBox.ItemsPanel>
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="ComboBoxItem" BasedOn="{StaticResource MaterialDesignComboBoxItem}">
                                        <EventSetter Event="Selected" Handler="OnParameterChanged"/>
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                            </ComboBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- Parameter Value Column -->
                <DataGridTemplateColumn Header="Parameter Value" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding AvailableParameterValues}"
                                      SelectedItem="{Binding ParameterValue, UpdateSourceTrigger=PropertyChanged}"
                                      materialDesign:HintAssist.Hint="Select Value"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      Margin="4,2">
                                <ComboBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </ComboBox.ItemsPanel>
                            </ComboBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- Material Column -->
                <DataGridTemplateColumn Header="Material" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ComboBox ItemsSource="{Binding DataContext.AvailableMaterials, RelativeSource={RelativeSource AncestorType=Window}}"
                                      SelectedItem="{Binding Material, UpdateSourceTrigger=PropertyChanged}"
                                      materialDesign:HintAssist.Hint="Select Material"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      Margin="4,2">
                                <ComboBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel/>
                                    </ItemsPanelTemplate>
                                </ComboBox.ItemsPanel>
                            </ComboBox>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Paint Options -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,12">
            <CheckBox Content="Side Face" 
                      IsChecked="{Binding IsSideFaceChecked}"
                      Style="{StaticResource MaterialDesignCheckBox}"
                      Margin="0,0,24,0"/>
            <CheckBox Content="Bottom Face" 
                      IsChecked="{Binding IsBottomFaceChecked}"
                      Style="{StaticResource MaterialDesignCheckBox}"
                      Margin="0,0,24,0"/>
            <CheckBox Content="Interfaces" 
                      IsChecked="{Binding IsInterfacesChecked}"
                      Style="{StaticResource MaterialDesignCheckBox}"/>
        </StackPanel>

        <!-- Interfaces Section -->
        <GroupBox Grid.Row="4" 
                  Header="Interfaces"
                  Visibility="{Binding IsInterfacesSectionVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                  Style="{StaticResource MaterialDesignGroupBox}"
                  Margin="0,0,0,12"
                  Padding="12">
            <StackPanel>
                <!-- Buttons and Count -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Button Content="Pick Faces"
                            Command="{Binding PickFacesCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Height="32"
                            Margin="0,0,8,0"
                            materialDesign:ButtonAssist.CornerRadius="4"/>
                    <Button Content="Clear All"
                            Command="{Binding ClearAllFacesCommand}"
                            Style="{StaticResource MaterialDesignOutlinedButton}"
                            Height="32"
                            Margin="0,0,16,0"
                            materialDesign:ButtonAssist.CornerRadius="4"/>
                    <TextBlock Text="{Binding SelectedFacesCount, StringFormat='ÄÃ£ chá»n: {0} faces'}"
                               VerticalAlignment="Center"
                               Style="{StaticResource MaterialDesignBody1TextBlock}"/>
                </StackPanel>

                <!-- Faces ListBox -->
                <ListBox ItemsSource="{Binding PickedFaces}"
                         MaxHeight="200"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         Style="{StaticResource MaterialDesignListBox}">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="0,4">
                                <CheckBox IsChecked="{Binding IsChecked}"
                                          Style="{StaticResource MaterialDesignCheckBox}"
                                          Margin="0,0,8,0"/>
                                <TextBlock VerticalAlignment="Center">
                                    <Run Text="{Binding FaceName, Mode=OneWay}"/>
                                    <Run Text=" - " Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Run Text="{Binding CategoryName, Mode=OneWay}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Run Text=" [ID: " Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Run Text="{Binding ElementId, Mode=OneWay}" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Run Text="]" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                </TextBlock>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem" BasedOn="{StaticResource MaterialDesignListBoxItem}">
                            <EventSetter Event="MouseDown" Handler="OnFaceItemClicked"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </StackPanel>
        </GroupBox>

        <!-- Note -->
        <Border Grid.Row="5"
                Background="#FFFEF3C7"
                BorderBrush="#FF8B6914"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12,8"
                Margin="0,0,0,12">
            <TextBlock Foreground="#FF8B6914"
                       FontStyle="Italic">
                <Run Text="ðŸ’¡"/>
                <Run Text="LÆ°u Ã½: Pháº£i transfer váº­t liá»‡u coffa trÆ°á»›c khi Paint"/>
            </TextBlock>
        </Border>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Remove Paint"
                    Command="{Binding RemovePaintCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Height="36"
                    Margin="0,0,8,0"
                    materialDesign:ButtonAssist.CornerRadius="4"/>
            <Button Content="Paint"
                    Command="{Binding PaintCommand}"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Height="36"
                    Margin="0,0,8,0"
                    materialDesign:ButtonAssist.CornerRadius="4"/>
            <Button Content="Close"
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Height="36"
                    materialDesign:ButtonAssist.CornerRadius="4"/>
        </StackPanel>
    </Grid>
</Window>
